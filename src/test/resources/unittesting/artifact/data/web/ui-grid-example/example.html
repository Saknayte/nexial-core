<!doctype html>
<html ng-app="app" lang="en">
<head>
  <script src="angular.js"></script>
  <script src="angular-touch.js"></script>
  <script src="angular-animate.js"></script>
  <script src="angular-aria.js"></script>
  <script src="csv.js"></script>
  <script src="pdfmake.js"></script>
  <script src="vfs_fonts.js"></script>
  <script src="lodash.min.js"></script>
  <script src="jszip.min.js"></script>
  <script src="excel-builder.dist.js"></script>
  <script src="ui-grid.js"></script>
  <script src="500_complex.js"></script>
  <link rel="stylesheet" href="ui-grid.css" type="text/css">
  <style>
    body {
      padding:     10px;
      font-family: Tahoma, sans-serif;
      font-size:   11pt;
    }

    .grid {
      width:  100%;
      height: 450px;
      margin: 5px 15px 5px 0;
    }

    .header-filtered { color: blue; }

    div.input_email input.input_email {
      padding: 3px;
      width:   180px !important;
    }

    .ui-grid-cell { height: 35px !important; }
  </style>
  <script>
    angular.module('app', ['ngAnimate', 'ngTouch', 'ui.grid', 'ui.grid.edit'])
           .controller('MainCtrl', MainCtrl)
           .filter('mapGender', mapGender);

    MainCtrl.$inject = ['$http', 'uiGridConstants'];

    function MainCtrl($http, uiGridConstants) {
      var vm       = this,
          today    = new Date(),
          nextWeek = new Date();
      nextWeek.setDate(nextWeek.getDate() + 7);

      vm.highlightFilteredHeader = function (row, rowRenderIndex, col, colRenderIndex) {
        if (col.filters[0].term) { return 'header-filtered'; } else { return ''; }
      };

      vm.gridOptions = {
        enableFiltering: true,
        onRegisterApi:   function (gridApi) { vm.gridApi = gridApi; },
        columnDefs:      [
          // default
          { field: 'name', headerCellClass: vm.highlightFilteredHeader },
          // pre-populated search field
          {
nun            field:      'gender', filter: {
              term:          '1',
              type:          uiGridConstants.filter.SELECT,
              selectOptions: [
                {value: '1', label: 'male'},
                {value: '2', label: 'female'},
                {value: '3', label: 'unknown'},
                {value: '4', label: 'not stated'},
                {value: '5', label: 'a really long value that extends things'}
              ]
            },
            cellFilter: 'mapGender', headerCellClass: vm.highlightFilteredHeader
          },
          // no filter input
          {
            field: 'company', enableFiltering: false, filter: {
              noTerm:    true,
              condition: function (searchTerm, cellValue) {
                return cellValue.match(/a/);
              }
            }
          },
          // specifies one of the built-in conditions
          // and a placeholder for the input
          {
            width:        '200',
            cellTemplate: '<div class="ui-grid-cell-contents input_email"><input type="text" name="email" class="input_email" value="{{ COL_FIELD }}"></div>',

            field:              'email',
            filter:             {
              condition:   uiGridConstants.filter.ENDS_WITH,
              placeholder: 'ends with'
            }, headerCellClass: vm.highlightFilteredHeader
          },
          // custom condition function
          {
            field:              'phone',
            filter:             {
              condition: function (searchTerm, cellValue) {
                var strippedValue = (cellValue + '').replace(/[^\d]/g, '');
                return strippedValue.indexOf(searchTerm) >= 0;
              }
            }, headerCellClass: vm.highlightFilteredHeader
          },
          // multiple filters
          {
            field:              'age', filters: [
              {
                condition:   uiGridConstants.filter.GREATER_THAN,
                placeholder: 'greater than'
              },
              {
                condition:   uiGridConstants.filter.LESS_THAN,
                placeholder: 'less than'
              }
            ], headerCellClass: vm.highlightFilteredHeader
          },
          // date filter
          {
            field:              'mixedDate', cellFilter: 'date', width: '15%', filter: {
              condition:   uiGridConstants.filter.LESS_THAN,
              placeholder: 'less than',
              term:        nextWeek
            }, headerCellClass: vm.highlightFilteredHeader
          },
          {
            field:              'mixedDate',
            displayName:        'Long Date',
            cellFilter:         'date:"longDate"',
            filterCellFiltered: true,
            width:              '15%'
          }
        ]
      };

      vm.gridOptions.data        = MyJsonData;
      vm.gridOptions.data[0].age = -5;

      MyJsonData.forEach(function addDates(row, index) {
        row.mixedDate = new Date();
        row.mixedDate.setDate(today.getDate() + (index % 14));
        row.gender = row.gender === 'male' ? '1' : '2';
      });

      vm.toggleFiltering = function () {
        vm.gridOptions.enableFiltering = !vm.gridOptions.enableFiltering;
        vm.gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN);
      };
    }

    function mapGender() {
      var genderHash = {
        1: 'male',
        2: 'female'
      };

      return function (input) {
        if (!input) {
          return '';
        } else {
          return genderHash[input];
        }
      };
    }
  </script>
  <title>ui-grid example</title>
</head>
<body>
<div ng-controller="MainCtrl as $ctrl">
  You can use asterisks to fuzz-match, i.e. use "*z*" as your filter to show any row where that column contains a "z".
  <br>
  <br>
  <strong>Note:</strong> The third column has the filter input disabled, but actually has a filter set in code that
  requires every company to have an 'a' in their name.
  <br>
  <br>
  <button id='toggleFiltering' ng-click="$ctrl.toggleFiltering()" class="btn btn-success">Toggle Filtering</button>
  <div id="grid1" ui-grid="$ctrl.gridOptions" class="grid"></div>
</div>
</body>
</html>